var owaspCSRFGuardScriptHasLoaded=owaspCSRFGuardScriptHasLoaded||{};if(!0!==owaspCSRFGuardScriptHasLoaded)!function(){if(owaspCSRFGuardScriptHasLoaded=!0,!window.csrfguarded){var e,t={listEvents:e=[],add:function(t,n,s){e.push(arguments)},flush:function(){var t,n;for(t=e.length-1;t>=0;t-=1){if((n=e[t])[0].removeEventListener)n[0].removeEventListener(n[1],n[2],n[3]);if('on'!==n[1].substring(0,2))n[1]='on'+n[1];if(n[0].detachEvent)n[0].detachEvent(n[1],n[2])}}};if(f(document.domain,'%DOMAIN_ORIGIN%')){var n='%TOKEN_NAME%',s='%TOKEN_VALUE%',i={isDomContentLoaded:!1},o={pageTokens:{}};if(r(window,'unload',t.flush),r(window,'DOMContentLoaded',(function(){if(i.isDomContentLoaded=!0,o.pageTokensLoaded)T(n,s,o.pageTokens)})),'%INJECT_DYNAMIC_NODES%')!function(){const e='%DYNAMIC_NODE_CREATION_EVENT_NAME%';if(e.length>0)r(window,e,(function(e){E([e.detail],n,s,o.pageTokens)}));else if(MutationObserver){const e=new MutationObserver((function(e,t){for(let t in e){const i=e[t],r=i.addedNodes;if('childList'===i.type&&r.length&&r.length>0)E(r,n,s,o.pageTokens)}}));e.observe(document,{attributes:!1,childList:!0,subtree:!0}),r(window,'unload',e.disconnect)}else r(window,'DOMNodeInserted',(function(e){const t=e.target||e.srcElement;if('DOMNodeInserted'===e.type)E([t],n,s,o.pageTokens)}))}();if('%INJECT_XHR%'){if('Microsoft Internet Explorer'===navigator.appName)!function(){var e=window.XMLHttpRequest;function t(){this.base=e?new e:new window.ActiveXObject('Microsoft.XMLHTTP')}function n(){return new t}n.prototype=t.prototype,n.UNSENT=0,n.OPENED=1,n.HEADERS_RECEIVED=2,n.LOADING=3,n.DONE=4,n.prototype.status=0,n.prototype.statusText='',n.prototype.readyState=n.UNSENT,n.prototype.responseText='',n.prototype.responseXML=null,n.prototype.onsend=null,n.url=null,n.onreadystatechange=null,n.prototype.open=function(e,t,n,s,i){var o=this;this.url=t,this.base.onreadystatechange=function(){try{o.status=o.base.status}catch(e){}try{o.statusText=o.base.statusText}catch(e){}try{o.readyState=o.base.readyState}catch(e){}try{o.responseText=o.base.responseText}catch(e){}try{o.responseXML=o.base.responseXML}catch(e){}if(null!==o.onreadystatechange)o.onreadystatechange.apply(this,arguments)},this.base.open(e,t,n,s,i)},n.prototype.send=function(e){if(null!==this.onsend)this.onsend.apply(this,arguments);this.base.send(e)},n.prototype.abort=function(){this.base.abort()},n.prototype.getAllResponseHeaders=function(){return this.base.getAllResponseHeaders()},n.prototype.getResponseHeader=function(e){return this.base.getResponseHeader(e)},n.prototype.setRequestHeader=function(e,t){return this.base.setRequestHeader(e,t)},window.XMLHttpRequest=n}();else XMLHttpRequest.prototype._open=XMLHttpRequest.prototype.open,XMLHttpRequest.prototype.open=function(e,t,n,s,i){this.url=t,this._open.apply(this,arguments)},XMLHttpRequest.prototype._send=XMLHttpRequest.prototype.send,XMLHttpRequest.prototype.send=function(e){if(null!==this.onsend)this.onsend.apply(this,arguments);this._send.apply(this,arguments)};XMLHttpRequest.prototype.onsend=function(e){r(this,'readystatechange',(function(){if(4===this.readyState){let e=this.getResponseHeader(n);if(null!=e)try{let t=JSON.parse(e),i=t.masterToken;if(void 0!==i)s=i;let r=t.pageTokens;if(void 0!==r)Object.keys(r).forEach((function(e){return o.pageTokens[e]=r[e]}));T(n,s,o.pageTokens)}catch(e){console.error('Error while updating tokens from response header.')}}}));if(d(this.url)&&l(this.url)){this.setRequestHeader('X-Requested-With','XMLHttpRequest');let e=function(e){var t=function(e,t){let n=e.indexOf(t);return n>0?e.substring(0,n):e};let n=a(e,'/')?e:'/'+e;return n=t(n,'?'),n=t(n,'#'),n}(this.url);if(null===o.pageTokens)this.setRequestHeader(n,s);else{let t=p(o.pageTokens,e);if(null==t){let t=function(e,t){let n=null,s=window.location.pathname.substring(1).split('/'),i='';for(let o=0;o<s.length-1;o++){i+='/'+s[o];let r=p(e,i+t);if(null!=r){n=r;break}}return n}(o.pageTokens,e);if(null===t)this.setRequestHeader(n,s);else this.setRequestHeader(n,t)}else this.setRequestHeader(n,t)}}}}if('%TOKENS_PER_PAGE%'){!function(e,t,n){const s=window.XMLHttpRequest?new window.XMLHttpRequest:new window.ActiveXObject('Microsoft.XMLHTTP');if(s.open('POST','%SERVLET_PATH%','%ASYNC_XHR%'),1)if(void 0!==e&&void 0!==t)s.setRequestHeader(e,t);s.onreadystatechange=function(){if(4===s.readyState)if(200===s.status){let e=JSON.parse(s.responseText).pageTokens;n.call(this,e)}else alert(s.status+': CSRF check failed')},s.send(null)}(n,s,(function(e){if(o.pageTokens=e,o.pageTokensLoaded=!0,i.isDomContentLoaded)T(n,s,e)}))}else r(window,'DOMContentLoaded',(function(){T(n,s,{})}));window.csrfguarded=!0}else alert('OWASP CSRFGuard JavaScript was included from within an unauthorized domain!')}function r(e,n,s){if(e.addEventListener)e.addEventListener(n,s,!1),t.add(e,n,s);else if(e.attachEvent)e['e'+n+s]=s,e[n+s]=function(){e['e'+n+s](window.event)},e.attachEvent('on'+n,e[n+s]),t.add(e,n,s);else e['on'+n]=e['e'+n+s]}function a(e,t){return 0===e.indexOf(t)}function u(e,t){return e.substring(e.length-t.length)===t}function l(e){let t=-1!==e.indexOf('?')?e.substring(0,e.indexOf('?')):e;return u(t,'.do')||t.indexOf('/*')>-1}function f(e,t){var n=!1;if(e===t)n=!0;else if(0)if('.'===t.charAt(0))n=u(e,t);else n=u(e,'.'+t);return n}function d(e){var t=!1;if('http://'===e.substring(0,7)||'https://'===e.substring(0,8)){for(var n=e.indexOf('://'),s=e.substring(n+'://'.length),i='',o=0;o<s.length;o++){var r=s.charAt(o);if('/'===r||':'===r||'#'===r)break;else i+=r}t=f(document.domain,i)}else if('#'===e.charAt(0))t=!1;else if(!a(e,'//')&&('/'===e.charAt(0)||-1===e.search(/^[a-zA-Z][a-zA-Z0-9.+-]*:/)))t=!0;return t}function c(e){var t='',n=e.indexOf('://'),s='';if(n>0)s=e.substring(n+'://'.length);else if('/'!==e.charAt(0))s='%CONTEXT_PATH%/'+e;else s=e;for(var i=-1===n,o=0;o<s.length;o++){var r=s.charAt(o);if('/'===r)i=!0;else if(!0===i&&('?'===r||'#'===r)){i=!1;break}if(!0===i)t+=r}return t}function p(e,t){let n=null;return Object.keys(e).forEach((function(s){var i=e[s];if(t===s)n=i;else if(a(s,'^')&&u(s,'$')){if(new RegExp(s).test(t))n=i}else if(a(s,'/*'))n=i;else if(a(t,'%CONTEXT_PATH%')&&u(s,t.substring('%CONTEXT_PATH%'.length)))n=i;else if(u(s,'/*')||a(s,'.*'))console.warn('\'Extension\' and \'partial path wildcard\' matching for page tokens is not supported properly yet! Every resource will be assigned a new unique token instead of using the defined resource matcher token. Although this is not a security issue, in case of a large REST application it can have an impact on performance.Consider using regular expressions instead.')})),n}function h(e,t,n,s,i){if(!i){var o=e.getAttribute('method');if(null!=o&&'get'===o.toLowerCase())return}var r=n,a=e.getAttribute('action');if(null!==a&&d(a)&&l(a)){const i=p(s,c(a));r=null==i?n:i;let o=Object.keys(e.elements).filter((function(n){return e.elements[n].name===t}));if(0===o.length){var u=document.createElement('input');u.setAttribute('type','hidden'),u.setAttribute('name',t),u.setAttribute('value',r),e.appendChild(u)}else o.forEach((function(t){return e.elements[t].value=r}))}}function g(e,t,n,s,i){const o=function(e,t,n){let s;if(-1===e.indexOf('?'))s=e+'?'+t+'='+n;else s=e+'&'+t+'='+n;return s},r=e.getAttribute&&e.getAttribute(t);if(null!=r&&d(r)&&l(r)&&!function(e){var t=!1,n='%UNPROTECTED_EXTENSIONS%';if(''!==n)for(var s=function(e){var t='';if(-1!==e.indexOf(';'))e=e.split(';')[0];if(-1!==e.indexOf('.'))t=e.substring(e.lastIndexOf('.')+1,e.length)||e;return t}(c(e)).toLowerCase(),i=n.split(','),o=0;o<i.length;o++)if(i[o]===s){t=!0;break}return t}(r)){const a=p(i,c(r)),u=null==a?s:a,l=new RegExp('(?:'+n+'=)([^?|#|&]+)','gi').exec(r);if(null===l||0===l.length){let s;const i=r.indexOf('#');if(-1!==i){const e=r.split('#')[0],t=r.substring(i);s=o(e,n,u)+t}else s=o(r,n,u);try{e.setAttribute(t,s)}catch(e){}}else{let n=r;l.slice(1).forEach((function(e){return n=n.replace(e,u)})),e.setAttribute(t,n)}}}function E(e,t,n,s){var i=e.length;for(let o=0;o<i;o++){let r=e[o];if(r.tagName&&'form'===r.tagName.toLowerCase()){if('%INJECT_FORMS%')h(r,t,n,s,'%INJECT_GET_FORMS%'),i=e.length;if('%INJECT_FORM_ATTRIBUTES%')g(r,'action',t,n,s)}else if('%INJECT_ATTRIBUTES%')g(r,'src',t,n,s),g(r,'href',t,n,s)}}function T(e,t,n){var s={};if('%TOKENS_PER_PAGE%')s=n;E(document.all?document.all:document.getElementsByTagName('*'),e,t,s)}}();
