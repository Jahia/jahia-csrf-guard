var owaspCSRFGuardScriptHasLoaded=owaspCSRFGuardScriptHasLoaded||{};!0!==owaspCSRFGuardScriptHasLoaded&&function(){if(owaspCSRFGuardScriptHasLoaded=!0,!window.csrfguarded){var e,t={listEvents:e=[],add:function(t,n,s){e.push(arguments)},flush:function(){var t,n;for(t=e.length-1;t>=0;t-=1)(n=e[t])[0].removeEventListener&&n[0].removeEventListener(n[1],n[2],n[3]),'on'!==n[1].substring(0,2)&&(n[1]='on'+n[1]),n[0].detachEvent&&n[0].detachEvent(n[1],n[2])}},n='%DOMAIN_ORIGIN%'.split(',');if(c(document.domain,n)){var s='%TOKEN_NAME%',o='%TOKEN_VALUE%',r={isDomContentLoaded:!1},a={pageTokens:{}};i(window,'unload',t.flush),i(window,'DOMContentLoaded',(function(){r.isDomContentLoaded=!0,a.pageTokensLoaded&&E(s,o,a.pageTokens)})),function(){const e='%DYNAMIC_NODE_CREATION_EVENT_NAME%';if(e)i(window,e,(function(e){w([e.detail],s,o,a.pageTokens)}));else if(MutationObserver){const e=new MutationObserver((function(e,t){for(let t in e){const n=e[t],r=n.addedNodes;'childList'===n.type&&r.length&&r.length>0&&w(r,s,o,a.pageTokens)}}));e.observe(document,{attributes:!1,childList:!0,subtree:!0}),i(window,'unload',e.disconnect)}else i(window,'DOMNodeInserted',(function(e){const t=e.target||e.srcElement;'DOMNodeInserted'===e.type&&w([t],s,o,a.pageTokens)}))}(),'Microsoft Internet Explorer'===navigator.appName?function(){var e=window.XMLHttpRequest;function t(){this.base=e?new e:new window.ActiveXObject('Microsoft.XMLHTTP')}function n(){return new t}n.prototype=t.prototype,n.UNSENT=0,n.OPENED=1,n.HEADERS_RECEIVED=2,n.LOADING=3,n.DONE=4,n.prototype.status=0,n.prototype.statusText='',n.prototype.readyState=n.UNSENT,n.prototype.responseText='',n.prototype.responseXML=null,n.prototype.onsend=null,n.url=null,n.onreadystatechange=null,n.prototype.open=function(e,t,n,s,o){var r=this;this.url=t,this.base.onreadystatechange=function(){try{r.status=r.base.status}catch(e){}try{r.statusText=r.base.statusText}catch(e){}try{r.readyState=r.base.readyState}catch(e){}try{r.responseText=r.base.responseText}catch(e){}try{r.responseXML=r.base.responseXML}catch(e){}null!==r.onreadystatechange&&r.onreadystatechange.apply(this,arguments)},this.base.open(e,t,n,s,o)},n.prototype.send=function(e){null!==this.onsend&&this.onsend.apply(this,arguments),this.base.send(e)},n.prototype.abort=function(){this.base.abort()},n.prototype.getAllResponseHeaders=function(){return this.base.getAllResponseHeaders()},n.prototype.getResponseHeader=function(e){return this.base.getResponseHeader(e)},n.prototype.setRequestHeader=function(e,t){return this.base.setRequestHeader(e,t)},window.XMLHttpRequest=n}():(XMLHttpRequest.prototype._open=XMLHttpRequest.prototype.open,XMLHttpRequest.prototype.open=function(e,t,n,s,o){this.url=t,this._open.apply(this,arguments)},XMLHttpRequest.prototype._send=XMLHttpRequest.prototype.send,XMLHttpRequest.prototype.send=function(e){null!==this.onsend&&this.onsend.apply(this,arguments),this._send.apply(this,arguments)}),XMLHttpRequest.prototype.onsend=function(e){i(this,'readystatechange',(function(){if(4===this.readyState&&-1!==this.getAllResponseHeaders().indexOf(s)){let e=this.getResponseHeader(s);try{let t=JSON.parse(e),n=t.masterToken;void 0!==n&&(o=n);let r=t.pageTokens;void 0!==r&&Object.keys(r).forEach((function(e){return a.pageTokens[e]=r[e]})),E(s,o,a.pageTokens)}catch(e){console.error('Error while updating tokens from response header.')}}}));if(p(this.url)&&l(this.url)){this.setRequestHeader('X-Requested-With','XMLHttpRequest');let e=function(e){var t=function(e,t){let n=e.indexOf(t);return n>0?e.substring(0,n):e};let n=u(e,'/')?e:'/'+e;return n=t(n,'?'),n=t(n,'#'),n}(this.url);if(null===a.pageTokens)this.setRequestHeader(s,o);else{let t=h(a.pageTokens,e);if(null==t){let t=function(e,t){let n=null,s=window.location.pathname.substring(1).split('/'),o='';for(let r=0;r<s.length-1;r++){o+='/'+s[r];let a=h(e,o+t);if(null!=a){n=a;break}}return n}(a.pageTokens,e);null===t?this.setRequestHeader(s,o):this.setRequestHeader(s,t)}else this.setRequestHeader(s,t)}}};!function(e,t,n){const s=window.XMLHttpRequest?new window.XMLHttpRequest:new window.ActiveXObject('Microsoft.XMLHTTP');s.open('POST','%SERVLET_PATH%','%ASYNC_XHR%'),void 0!==e&&void 0!==t&&s.setRequestHeader(e,t),s.onreadystatechange=function(){if(4===s.readyState)if(200===s.status){let e=JSON.parse(s.responseText).pageTokens;n.call(this,e)}else alert(s.status+': CSRF check failed')},s.send(null)}(s,o,(function(e){a.pageTokens=e,a.pageTokensLoaded=!0,r.isDomContentLoaded&&E(s,o,e)}));window.csrfguarded=!0}else alert('OWASP CSRFGuard JavaScript was included from within an unauthorized domain!')}function i(e,n,s){e.addEventListener?(e.addEventListener(n,s,!1),t.add(e,n,s)):e.attachEvent?(e['e'+n+s]=s,e[n+s]=function(){e['e'+n+s](window.event)},e.attachEvent('on'+n,e[n+s]),t.add(e,n,s)):e['on'+n]=e['e'+n+s]}function u(e,t){return 0===e.indexOf(t)}function d(e,t){return e.substring(e.length-t.length)===t}function l(e){let t=-1!==e.indexOf('?')?e.substring(0,e.indexOf('?')):e;return d(t,'.do')||t.indexOf('/*')>-1}function c(e,t){var n=!1;if(t&&t.constructor===Array)for(var s=0;s<t.length;s++)if(c(e,t[s]))return!0;return e===t&&(n=!0),n}function p(e){var t=!1;if('http://'===e.substring(0,7)||'https://'===e.substring(0,8)){for(var n=e.indexOf('://'),s=e.substring(n+3),o='',r=0;r<s.length;r++){var a=s.charAt(r);if('/'===a||':'===a||'#'===a)break;o+=a}t=c(document.domain,o)}else'#'===e.charAt(0)?t=!1:u(e,'//')||'/'!==e.charAt(0)&&-1!==e.search(/^[a-zA-Z][a-zA-Z0-9.+-]*:/)||(t=!0);return t}function f(e){var t='',n=e.indexOf('://'),s='';s=n>0?e.substring(n+3):'/'!==e.charAt(0)?'%CONTEXT_PATH%/'+e:e;for(var o=-1===n,r=0;r<s.length;r++){var a=s.charAt(r);if('/'===a)o=!0;else if(!0===o&&('?'===a||'#'===a)){o=!1;break}!0===o&&(t+=a)}return t}function h(e,t){let n=null;return Object.keys(e).forEach((function(s){var o=e[s];t===s?n=o:u(s,'^')&&d(s,'$')?new RegExp(s).test(t)&&(n=o):u(s,'/*')||u(t,'%CONTEXT_PATH%')&&d(s,t.substring(14))?n=o:(d(s,'/*')||u(s,'.*'))&&console.warn('\'Extension\' and \'partial path wildcard\' matching for page tokens is not supported properly yet! Every resource will be assigned a new unique token instead of using the defined resource matcher token. Although this is not a security issue, in case of a large REST application it can have an impact on performance.Consider using regular expressions instead.')})),n}function g(e,t,n,s,o){if(!o){var r=e.getAttribute('method');if(null!=r&&'get'===r.toLowerCase())return}var a=n,i=e.getAttribute('action');if(null!==i&&p(i)&&l(i)){const o=h(s,f(i));a=null==o?n:o;let r=Object.keys(e.elements).filter((function(n){return e.elements[n].name===t}));if(0===r.length){var u=document.createElement('input');u.setAttribute('type','hidden'),u.setAttribute('name',t),u.setAttribute('value',a),e.appendChild(u)}else r.forEach((function(t){return e.elements[t].value=a}))}}function y(e,t,n,s,o){const r=function(e,t,n){let s;return s=-1===e.indexOf('?')?e+'?'+t+'='+n:e+'&'+t+'='+n,s},a=e.getAttribute&&e.getAttribute(t);if(null!=a&&p(a)&&l(a)&&!function(e){var t=!1,n='%UNPROTECTED_EXTENSIONS%';if(''!==n)for(var s=function(e){var t='';-1!==e.indexOf(';')&&(e=e.split(';')[0]);-1!==e.indexOf('.')&&(t=e.substring(e.lastIndexOf('.')+1,e.length)||e);return t}(f(e)).toLowerCase(),o=n.split(','),r=0;r<o.length;r++)if(o[r]===s){t=!0;break}return t}(a)){const i=h(o,f(a)),u=null==i?s:i,d=new RegExp('(?:'+n+'=)([^?|#|&]+)','gi').exec(a);if(null===d||0===d.length){let s;const o=a.indexOf('#');if(-1!==o){const e=a.split('#')[0],t=a.substring(o);s=r(e,n,u)+t}else s=r(a,n,u);try{e.setAttribute(t,s)}catch(e){}}else{let n=a;d.slice(1).forEach((function(e){return n=n.replace(e,u)})),e.setAttribute(t,n)}}}function w(e,t,n,s){var o=e.length;for(let r=0;r<o;r++){let a=e[r];a.tagName&&'form'===a.tagName.toLowerCase()?(g(a,t,n,s,'%INJECT_GET_FORMS%'),o=e.length,y(a,'action',t,n,s)):(y(a,'src',t,n,s),y(a,'href',t,n,s))}}function E(e,t,n){var s={};s=n,w(document.all?document.all:document.getElementsByTagName('*'),e,t,s)}}();
